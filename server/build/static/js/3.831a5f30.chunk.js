(this["webpackJsonpchat-app"]=this["webpackJsonpchat-app"]||[]).push([[3],{103:function(t,e,n){"use strict";n(0);var r=n(2),a={small:{flex:"0 0 28px",height:"28px"},medium:{flex:"0 0 40px",height:"40px"},large:{flex:"0 0 60px",height:"60px"}};e.a=function(t){var e=t.imgSrc,n=void 0===e?"https://i.pravatar.cc/300":e,o=t.size,c=void 0===o?"medium":o;return Object(r.jsx)("div",{className:"avatar round",style:a[c],children:Object(r.jsx)("img",{className:"round",style:{padding:"1px"},src:n,alt:""})})}},104:function(t,e,n){"use strict";var r=n(17),a=n(37),o=(n(0),n(2)),c=["iconName","variant","type","size","color","className"];e.a=function(t){var e=t.iconName,n=t.variant,i=t.type,s=t.size,u=t.color,l=t.className,m=Object(a.a)(t,c),f=["btn"];return null===l||void 0===l||l.split(" ").forEach((function(t){return f.push(t)})),"clear"===n&&f.push("btn--nobg"),"large"===s&&f.push("btn--large"),Object(o.jsx)("button",Object(r.a)(Object(r.a)({},m),{},{type:i,className:f.join(" "),children:Object(o.jsx)("span",{style:{color:u},className:"material-icons-round",children:e})}))}},106:function(t,e,n){},107:function(t,e,n){},110:function(t,e,n){"use strict";n.r(e);var r=n(17),a=n(32);var o=n(39);function c(t){return function(t){if(Array.isArray(t))return Object(a.a)(t)}(t)||function(t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||Object(o.a)(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var i=n(18),s=n(0),u=n(3),l=n(14),m=n(38),f=n(26),d=n(103),j=n(104),v=n(2),b=function(t){var e=t.photoURL,n=t.displayName;return Object(v.jsxs)("div",{className:"chat__header",children:[Object(v.jsxs)("div",{className:"left",children:[Object(v.jsx)(d.a,{imgSrc:e,size:"medium"}),Object(v.jsxs)("div",{className:"chat-info",children:[Object(v.jsx)("p",{className:"chat-info__name",children:n}),Object(v.jsx)("p",{className:"chat-info__status",children:"Active now"})]})]}),Object(v.jsxs)("div",{className:"right",children:[Object(v.jsx)(j.a,{variant:"clear",iconName:"phone_in_talk",color:"var(--primary)"}),Object(v.jsx)(j.a,{variant:"clear",iconName:"video_call",color:"var(--primary)"}),Object(v.jsx)(j.a,{variant:"clear",iconName:"more_horiz",color:"var(--primary)"})]})]})},h=function(t){var e=t.msgText,n=t.className,r=t.self,a=t.roomPhotoURL;return Object(v.jsxs)("div",{className:n,children:[!r&&Object(v.jsx)(d.a,{size:"small",imgSrc:a}),Object(v.jsx)("div",{className:"msg-list",children:null===e||void 0===e?void 0:e.map((function(t,e){var n=t.content,r=t.timestamp,a=new Date(r-6e4*(new Date).getTimezoneOffset()).toLocaleString("en-GB",{timeZone:"UTC"});return Object(v.jsx)("p",{"data-time":a,children:n},e)}))})]})},p=(n(106),function(t){var e=t.msgList,n=t.uid,r=t.roomPhotoURL,a=Object(s.useRef)(null);return Object(s.useEffect)((function(){a.current.scrollTop=a.current.scrollHeight}),[e]),Object(v.jsx)("div",{ref:a,className:"chatbox-msg-container",children:null===e||void 0===e?void 0:e.map((function(t,e){var a=(null===t||void 0===t?void 0:t.from)===n?"msg msg--mine":"msg",o=(null===t||void 0===t?void 0:t.from)===n;return Object(v.jsx)(h,{className:a,self:o,roomPhotoURL:r,msgText:null===t||void 0===t?void 0:t.msg},e)}))})}),O=function(t){var e=t.roomID,n=t.uid,r=t.pushNewMsg,a=Object(s.useState)(""),o=Object(i.a)(a,2),c=o[0],u=o[1],l=Object(m.b)().updateContactLastMsg;Object(s.useEffect)((function(){return f.a.on("msg:create",(function(t){var e=t.success,n=t.doc;e&&(r(n),l(n.to,n))})),function(){f.a.off("msg:create")}}),[r,l]);return Object(v.jsx)("div",{className:"msg-form",children:Object(v.jsxs)("form",{onSubmit:function(t){if(t.preventDefault(),c.trim()){var r={from:n,to:e,content:c};f.a.emit("msg:create",r)}u("")},children:[Object(v.jsx)("input",{type:"text",placeholder:"Aa",value:c,onChange:function(t){return u(t.target.value)}}),Object(v.jsx)(j.a,{variant:"clear",size:"large",iconName:"send",color:"var(--primary)"})]})})};var g=function(t){var e,n=[],r={from:"",msg:[]},a=function(t,e){var n;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=Object(o.a)(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,a=function(){};return{s:a,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,i=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return i=t.done,t},e:function(t){s=!0,c=t},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw c}}}}(t=Array.from(t));try{for(a.s();!(e=a.n()).done;){var c=e.value,i={timestamp:c.timestamp,content:c.content};r.from?c.from!==r.from?(n.push(r),r={from:c.from,msg:[i]}):r.msg.push(i):(r.from=c.from,r.msg=[i])}}catch(s){a.e(s)}finally{a.f()}return r.from&&n.push(r),n},x=(n(107),function(){var t,e=Object(s.useState)(null),n=Object(i.a)(e,2),a=n[0],o=n[1],d=Object(u.h)().roomID,j=Object(s.useState)([]),h=Object(i.a)(j,2),x=h[0],y=h[1],N=null===(t=Object(l.c)().user)||void 0===t?void 0:t.uid,S=Object(m.b)().updateContactLastMsg,w=Object(s.useCallback)((function(t){var e=c(x),n=e.pop(),r={timestamp:t.timestamp,content:t.content};if(n){if((null===n||void 0===n?void 0:n.from)===(null===t||void 0===t?void 0:t.from))n.msg.push(r),e.push(n);else{var a={from:t.from,msg:[r]};e.push(n),e.push(a)}y(e)}else y([{from:t.from,msg:[r]}])}),[x]);return Object(s.useEffect)((function(){fetch("/api/user/"+d).then((function(t){return t.json()})).then((function(t){o(t)})).catch((function(t){console.log(t)}))}),[d]),Object(s.useEffect)((function(){fetch("/api/message?from=".concat(N,"&to=").concat(d)).then((function(t){return t.json()})).then((function(t){var e=c(t).sort((function(t,e){return t.timestamp-e.timestamp})),n=g(e);y(n)}))}),[d,N]),Object(s.useEffect)((function(){return f.a.on("private msg",(function(t){var e=t.doc;e.from===d&&w(e),S(e.from,e)})),function(){f.a.off("private msg")}}),[w,d,S]),(null===a||void 0===a?void 0:a.uid)===d?Object(v.jsxs)("div",{className:"chat",children:[Object(v.jsx)(b,Object(r.a)({},a)),Object(v.jsx)(p,{roomPhotoURL:null===a||void 0===a?void 0:a.photoURL,uid:N,msgList:x}),Object(v.jsx)(O,{pushNewMsg:w,roomID:d,uid:N})]}):Object(v.jsx)("p",{children:"Loading..."})});e.default=x}}]);