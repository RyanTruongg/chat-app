(this["webpackJsonpchat-app"]=this["webpackJsonpchat-app"]||[]).push([[0],{109:function(e,t,n){"use strict";n.r(t);var c=n(3),a=n.n(c),o=n(62),r=n.n(o),s=n(22),i=n(9),l=n(14),u=n.p+"static/media/search.ffb58015.svg",j=n(2),d={small:{width:"28px",height:"28px"},medium:{width:"40px",height:"40px"},large:{width:"60px",height:"60px"}},h=function(e){var t=e.imgSrc,n=void 0===t?"https://i.pravatar.cc/300":t,c=e.size,a=void 0===c?"medium":c;return Object(j.jsx)("div",{className:"avatar round",style:d[a],children:Object(j.jsx)("img",{className:"round",style:{padding:"1px"},src:n,alt:""})})},b=n(16),m=n(27),f=["iconName","variant","type","size","color"],v=function(e){var t=e.iconName,n=e.variant,c=e.type,a=e.size,o=e.color,r=Object(m.a)(e,f),s=["btn"];return"clear"===n&&s.push("btn--nobg"),"large"===a&&s.push("btn--large"),Object(j.jsx)("button",Object(b.a)(Object(b.a)({},r),{},{type:c,className:s.join(" "),children:Object(j.jsx)("span",{style:{color:o},className:"material-icons-round",children:t})}))},O=n(63),p=Object(O.io)("https://msg-chatapp.herokuapp.com/",{autoConnect:!1});p.on("connect_error",(function(){console.log("connect_error")}));var g=p,x=n(44);n.e(9).then(n.bind(null,113));x.a.initializeApp({apiKey:"AIzaSyBtLFctIyZhPquAqnrLP8DxOCJnDv16xvI",authDomain:"chat-app-73a8d.firebaseapp.com",projectId:"chat-app-73a8d",storageBucket:"chat-app-73a8d.appspot.com",messagingSenderId:"1026946776432",appId:"1:1026946776432:web:0e06c59bd41ce6ea01e3b5",measurementId:"G-QKZ0YM2KWT"});var N=x.a,S=["children"],L=a.a.createContext();function y(e){var t=e.children,n=function(){var e=Object(c.useState)(null),t=Object(l.a)(e,2),n=t[0],a=t[1],o=Object(c.useState)("listening"),r=Object(l.a)(o,2),s=r[0],i=r[1];return Object(c.useEffect)((function(){return N.auth().onAuthStateChanged((function(e){e?(a(e),i("loged")):(a(null),i("notloged"))}))}),[]),Object(c.useEffect)((function(){"loged"===s&&n&&(g.auth={user:n},g.connect())}),[n,s]),{loginState:s,user:n,signin:function(){var e=new N.auth.GoogleAuthProvider;N.auth().signInWithRedirect(e).then((function(){console.log("Login Success")})).catch((function(){console.log("Login Failed")}))},signout:function(){N.auth().signOut().then((function(){return a(null)}))}}}();return Object(j.jsx)(L.Provider,{value:n,children:t})}function D(){return Object(c.useContext)(L)}function I(e){var t=e.children,n=Object(m.a)(e,S),c=D();return Object(j.jsx)(i.b,Object(b.a)(Object(b.a)({},n),{},{render:function(e){var n=e.location;switch(c.loginState){case"listening":return Object(j.jsx)("p",{children:"Loading..."});case"loged":return t;case"notloged":return Object(j.jsx)(i.a,{to:{pathname:"/login",state:{from:n}}});default:return Object(j.jsx)("p",{children:"Error"})}}}))}function _(){var e=Object(c.useState)(""),t=Object(l.a)(e,2),n=t[0],a=t[1];return Object(j.jsxs)(j.Fragment,{children:[Object(j.jsx)("input",{type:"text",placeholder:"Search messenger",value:n,onChange:function(e){return a(e.target.value)}}),!n&&Object(j.jsx)("img",{src:u,alt:""})]})}var w=function(e){var t=e.providerData,n=D(),c=(t||{}).photoURL;return Object(j.jsxs)("header",{className:"sidebar-header",children:[Object(j.jsxs)("div",{className:"sidebar-top",children:[Object(j.jsxs)("div",{className:"sidebar-top-left",children:[Object(j.jsx)(h,{imgSrc:c}),Object(j.jsx)("span",{children:"Chats"})]}),Object(j.jsxs)("div",{className:"sidebar-top-right",children:[Object(j.jsx)(v,{iconName:"more_horiz"}),Object(j.jsx)(v,{iconName:"add"}),Object(j.jsx)(v,{iconName:"logout",onClick:n.signout})]})]}),Object(j.jsx)("div",{className:"sidebar-bottom",children:Object(j.jsx)(_,{})})]})},C=function(e){var t=e.username,n=void 0===t?"Thanh Nhut":t,c=e.photoURL,a=e.lastMsg,o=void 0===a?"Lorem ipsum dolor,adfadf asdfasfafasfsafasfasdfs Tui laf":a,r=e.to;return Object(j.jsxs)(s.b,{to:r,className:"chatbox-card",children:[Object(j.jsx)(h,{imgSrc:c,size:"large"}),Object(j.jsxs)("div",{className:"chatbox-card__info",children:[Object(j.jsx)("span",{style:{display:"block",fontWeight:"600"},children:n}),Object(j.jsx)("span",{children:o})]})]})},k=["userID"],z=function(e){var t=e.listData;return Object(j.jsx)("div",{className:"chatbox-list",children:null===t||void 0===t?void 0:t.map((function(e){var t=e.userID,n=Object(m.a)(e,k);return Object(j.jsx)(C,Object(b.a)(Object(b.a)({},n),{},{to:"/home/t/"+t}),t)}))})};n.e(6).then(n.t.bind(null,112,7));var E=function(){var e,t,n=Object(c.useState)([]),a=Object(l.a)(n,2),o=a[0],r=a[1],s=D();return Object(c.useEffect)((function(){return"loged"===s.loginState&&g.on("users",(function(e){var t;console.log(e),console.log(null===(t=s.user)||void 0===t?void 0:t.uid),e=e.filter((function(e){var t;return(null===e||void 0===e?void 0:e.userID)!==(null===(t=s.user)||void 0===t?void 0:t.uid)})),r(e)})),function(){g.off("users")}}),[s.loginState,null===(e=s.user)||void 0===e?void 0:e.uid]),Object(j.jsxs)("div",{className:"sidebar",children:[Object(j.jsx)(w,{providerData:null===(t=s.user)||void 0===t?void 0:t.providerData[0]}),Object(j.jsx)(z,{listData:o})]})},P=n(65),R=n(45),A=function(e){var t=e.photoURL,n=e.displayName;return Object(j.jsxs)("div",{className:"chatbox__header",children:[Object(j.jsxs)("div",{className:"left",children:[Object(j.jsx)(h,{imgSrc:t,size:"medium"}),Object(j.jsxs)("div",{className:"chatbox-info",children:[Object(j.jsx)("p",{className:"chatbox-info__name",children:n}),Object(j.jsx)("p",{className:"chatbox-info__status",children:"Active now"})]})]}),Object(j.jsxs)("div",{className:"right",children:[Object(j.jsx)(v,{variant:"clear",iconName:"phone_in_talk",color:"var(--pink300)"}),Object(j.jsx)(v,{variant:"clear",iconName:"video_call",color:"var(--pink300)"}),Object(j.jsx)(v,{variant:"clear",iconName:"more_horiz",color:"var(--pink300)"})]})]})},T=function(e){var t=e.msgText,n=e.className,c=e.self,a=e.roomPhotoURL;return Object(j.jsxs)("div",{className:n,children:[!c&&Object(j.jsx)(h,{size:"small",imgSrc:a}),Object(j.jsx)("div",{className:"msg-list",children:t&&t.map((function(e,t){return Object(j.jsx)("p",{children:e},t)}))})]})};n.e(3).then(n.t.bind(null,115,7));var U=function(e){var t=e.msgList,n=e.uid,a=e.roomPhotoURL,o=Object(c.useRef)(null);return Object(c.useEffect)((function(){o.current.scrollTop=o.current.scrollHeight}),[t]),Object(j.jsx)("div",{ref:o,className:"chatbox-msg-container",children:null===t||void 0===t?void 0:t.map((function(e,t){var c=(null===e||void 0===e?void 0:e.from)===n?"msg msg--mine":"msg",o=(null===e||void 0===e?void 0:e.from)===n;return Object(j.jsx)(T,{roomPhotoURL:a,self:o,msgText:null===e||void 0===e?void 0:e.msg,className:c},t)}))})},F=function(e){var t=e.roomID,n=e.uid,a=e.pushNewMsg,o=Object(c.useState)(""),r=Object(l.a)(o,2),s=r[0],i=r[1];Object(c.useEffect)((function(){return g.on("msg:create",(function(e){var t=e.success,n=e._doc;t&&a(n)})),function(){g.off("msg:create")}}),[a]);return Object(j.jsx)("div",{className:"chatbox-msg-input",children:Object(j.jsxs)("form",{onSubmit:function(e){if(e.preventDefault(),s.trim()){var c={from:n,to:t,content:s,timestamp:Date.now()};g.emit("msg:create",c)}i("")},children:[Object(j.jsx)("input",{type:"text",placeholder:"Aa",value:s,onChange:function(e){return i(e.target.value)}}),Object(j.jsx)(v,{variant:"clear",size:"large",iconName:"send",color:"var(--pink300)"})]})})};n.e(4).then(n.t.bind(null,114,7));var M=function(){var e,t=Object(c.useState)(null),n=Object(l.a)(t,2),a=n[0],o=n[1],r=Object(i.h)().roomID,s=Object(c.useState)([]),u=Object(l.a)(s,2),d=u[0],h=u[1],m=null===(e=D().user)||void 0===e?void 0:e.uid,f=Object(c.useCallback)((function(e){var t=Object(R.a)(d),n=t.pop();if(n){if((null===n||void 0===n?void 0:n.from)===(null===e||void 0===e?void 0:e.from))n.msg.push(e.content),t.push(n);else{var c={from:e.from,msg:[e.content]};t.push(n),t.push(c)}h(t)}else h([{from:e.from,msg:[e.content]}])}),[d]);Object(c.useEffect)((function(){fetch("/api/user/"+r).then((function(e){return e.json()})).then((function(e){o(e),console.log(e)})).catch((function(e){console.log(e)}))}),[r]),Object(c.useEffect)((function(){fetch("/api/message?from=".concat(m,"&to=").concat(r)).then((function(e){return e.json()})).then((function(e){var t=Object(R.a)(e).sort((function(e,t){return e.timestamp-t.timestamp})),n=v(t);h(n)}))}),[r,m]),Object(c.useEffect)((function(){return g.on("private msg",(function(e){e.from===r&&f(e)})),function(){g.off("private msg")}}),[f,r]);var v=function(e){console.log({_msgList:e}),e=Array.from(e);var t,n=[],c={from:"",msg:[]},a=Object(P.a)(e);try{for(a.s();!(t=a.n()).done;){var o=t.value;c.from?o.from!==c.from?(n.push(c),c={from:o.from,msg:[o.content]}):c.msg.push(o.content):(c.from=o.from,c.msg=[o.content])}}catch(r){a.e(r)}finally{a.f()}return n.push(c),n};return a?Object(j.jsxs)("div",{className:"chatbox",children:[Object(j.jsx)(A,Object(b.a)({},a)),Object(j.jsx)(U,{roomPhotoURL:null===a||void 0===a?void 0:a.photoURL,uid:m,msgList:d}),Object(j.jsx)(F,{pushNewMsg:f,roomID:r,uid:m})]}):Object(j.jsx)("p",{children:"Loading..."})};n.e(5).then(n.t.bind(null,116,7));var B=function(){var e=Object(i.g)(),t=D();switch(t.loginState){case"listening":return Object(j.jsx)("p",{children:"Loading..."});case"loged":return Object(j.jsx)(i.a,{to:{pathname:"/",state:{from:e}}});case"notloged":return Object(j.jsx)("div",{className:"login",children:Object(j.jsx)("button",{onClick:t.signin,children:"Sign in with Google"})});default:return Object(j.jsx)("p",{children:"Error"})}};var G=function(){return Object(j.jsx)("div",{className:"app",children:Object(j.jsx)(y,{children:Object(j.jsxs)(s.a,{children:[Object(j.jsx)(i.b,{exact:!0,path:"/login",children:Object(j.jsx)(B,{})}),Object(j.jsx)(I,{exact:!0,path:"/",children:Object(j.jsx)(i.a,{to:"home"})}),Object(j.jsx)(I,{path:"/home",children:Object(j.jsxs)(s.a,{children:[Object(j.jsx)(E,{}),Object(j.jsx)(i.d,{children:Object(j.jsx)(I,{exact:!0,path:"/home/t/:roomID",children:Object(j.jsx)(M,{})})})]})})]})})})},J=function(e){e&&e instanceof Function&&n.e(10).then(n.bind(null,117)).then((function(t){var n=t.getCLS,c=t.getFID,a=t.getFCP,o=t.getLCP,r=t.getTTFB;n(e),c(e),a(e),o(e),r(e)}))};n.e(8).then(n.t.bind(null,110,7)),n.e(7).then(n.t.bind(null,111,7)),r.a.render(Object(j.jsx)(a.a.StrictMode,{children:Object(j.jsx)(G,{})}),document.getElementById("root")),J()}},[[109,1,2]]]);
//# sourceMappingURL=main.dac74760.chunk.js.map