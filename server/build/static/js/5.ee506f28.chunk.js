(this["webpackJsonpchat-app"]=this["webpackJsonpchat-app"]||[]).push([[5],{100:function(e,t,n){"use strict";var r=n(15),a=n(33),o=(n(0),n(1)),c=["iconName","variant","type","size","color","className"];t.a=function(e){var t=e.iconName,n=e.variant,i=e.type,s=e.size,u=e.color,l=e.className,m=Object(a.a)(e,c),f=["btn"];return null===l||void 0===l||l.split(" ").forEach((function(e){return f.push(e)})),"clear"===n&&f.push("btn--nobg"),"large"===s&&f.push("btn--large"),Object(o.jsx)("button",Object(r.a)(Object(r.a)({},m),{},{type:i,className:f.join(" "),children:Object(o.jsx)("span",{style:{color:u},className:"material-icons-round",children:t})}))}},104:function(e,t,n){},105:function(e,t,n){},112:function(e,t,n){"use strict";n.r(t);var r=n(15),a=n(53),o=n(16),c=n(0),i=n(2),s=n(12),u=n(35),l=n(25),m=n(99),f=n(100),j=n(1),d=function(e){var t=e.photoURL,n=e.displayName;return Object(j.jsxs)("div",{className:"chat__header",children:[Object(j.jsxs)("div",{className:"left",children:[Object(j.jsx)(m.a,{imgSrc:t,size:"medium"}),Object(j.jsxs)("div",{className:"chat-info",children:[Object(j.jsx)("p",{className:"chat-info__name",children:n}),Object(j.jsx)("p",{className:"chat-info__status",children:"Active now"})]})]}),Object(j.jsxs)("div",{className:"right",children:[Object(j.jsx)(f.a,{variant:"clear",iconName:"phone_in_talk",color:"var(--primary)"}),Object(j.jsx)(f.a,{variant:"clear",iconName:"video_call",color:"var(--primary)"}),Object(j.jsx)(f.a,{variant:"clear",iconName:"more_horiz",color:"var(--primary)"})]})]})},v=function(e){var t=e.msgText,n=e.className,r=e.self,a=e.roomPhotoURL;return Object(j.jsxs)("div",{className:n,children:[!r&&Object(j.jsx)(m.a,{size:"small",imgSrc:a}),Object(j.jsx)("div",{className:"msg-list",children:null===t||void 0===t?void 0:t.map((function(e,t){var n=e.content,r=e.timestamp,a=new Date(r-6e4*(new Date).getTimezoneOffset()).toLocaleString("en-GB",{timeZone:"UTC"});return Object(j.jsx)("p",{"data-time":a,children:n},t)}))})]})},h=(n(104),function(e){var t=e.msgList,n=e.uid,r=e.roomPhotoURL,a=Object(c.useRef)(null);return Object(c.useEffect)((function(){a.current.scrollTop=a.current.scrollHeight}),[t]),Object(j.jsx)("div",{ref:a,className:"chatbox-msg-container",children:null===t||void 0===t?void 0:t.map((function(e,t){var a=(null===e||void 0===e?void 0:e.from)===n?"msg msg--mine":"msg",o=(null===e||void 0===e?void 0:e.from)===n;return Object(j.jsx)(v,{className:a,self:o,roomPhotoURL:r,msgText:null===e||void 0===e?void 0:e.msg},t)}))})}),b=function(e){var t=e.roomID,n=e.uid,r=e.pushNewMsg,a=Object(c.useState)(""),i=Object(o.a)(a,2),s=i[0],m=i[1],d=Object(u.b)().updateContactLastMsg;Object(c.useEffect)((function(){return l.a.on("msg:create",(function(e){var t=e.success,n=e.doc;t&&(r(n),d(n.to,n))})),function(){l.a.off("msg:create")}}),[r,d]);return Object(j.jsx)("div",{className:"msg-form",children:Object(j.jsxs)("form",{onSubmit:function(e){if(e.preventDefault(),s.trim()){var r={from:n,to:t,content:s};l.a.emit("msg:create",r)}m("")},children:[Object(j.jsx)("input",{type:"text",placeholder:"Aa",value:s,onChange:function(e){return m(e.target.value)}}),Object(j.jsx)(f.a,{variant:"clear",size:"large",iconName:"send",color:"var(--primary)"})]})})},p=n(24);var O=function(e){var t,n=[],r={from:"",msg:[]},a=function(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=Object(p.a)(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,i=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return c=e.done,e},e:function(e){i=!0,o=e},f:function(){try{c||null==n.return||n.return()}finally{if(i)throw o}}}}(e=Array.from(e));try{for(a.s();!(t=a.n()).done;){var o=t.value,c={timestamp:o.timestamp,content:o.content};r.from?o.from!==r.from?(n.push(r),r={from:o.from,msg:[c]}):r.msg.push(c):(r.from=o.from,r.msg=[c])}}catch(i){a.e(i)}finally{a.f()}return r.from&&n.push(r),n},g=(n(105),function(){var e,t=Object(c.useState)(null),n=Object(o.a)(t,2),m=n[0],f=n[1],v=Object(i.h)().roomID,p=Object(c.useState)([]),g=Object(o.a)(p,2),x=g[0],N=g[1],y=null===(e=Object(s.c)().user)||void 0===e?void 0:e.uid,L=Object(u.b)().updateContactLastMsg,S=Object(c.useCallback)((function(e){var t=Object(a.a)(x),n=t.pop(),r={timestamp:e.timestamp,content:e.content};if(n){if((null===n||void 0===n?void 0:n.from)===(null===e||void 0===e?void 0:e.from))n.msg.push(r),t.push(n);else{var o={from:e.from,msg:[r]};t.push(n),t.push(o)}N(t)}else N([{from:e.from,msg:[r]}])}),[x]);return Object(c.useEffect)((function(){fetch("/api/user/"+v).then((function(e){return e.json()})).then((function(e){f(e)})).catch((function(e){console.log(e)}))}),[v]),Object(c.useEffect)((function(){fetch("/api/message?from=".concat(y,"&to=").concat(v)).then((function(e){return e.json()})).then((function(e){var t=Object(a.a)(e).sort((function(e,t){return e.timestamp-t.timestamp})),n=O(t);N(n)}))}),[v,y]),Object(c.useEffect)((function(){return l.a.on("private msg",(function(e){var t=e.doc;t.from===v&&S(t),L(t.from,t)})),function(){l.a.off("private msg")}}),[S,v,L]),(null===m||void 0===m?void 0:m.uid)===v?Object(j.jsxs)("div",{className:"chat",children:[Object(j.jsx)(d,Object(r.a)({},m)),Object(j.jsx)(h,{roomPhotoURL:null===m||void 0===m?void 0:m.photoURL,uid:y,msgList:x}),Object(j.jsx)(b,{pushNewMsg:S,roomID:v,uid:y})]}):Object(j.jsx)("p",{children:"Loading..."})});t.default=g},99:function(e,t,n){"use strict";n(0);var r=n(1),a={small:{flex:"0 0 28px",height:"28px"},medium:{flex:"0 0 40px",height:"40px"},large:{flex:"0 0 60px",height:"60px"}};t.a=function(e){var t=e.imgSrc,n=void 0===t?"https://i.pravatar.cc/300":t,o=e.size,c=void 0===o?"medium":o;return Object(r.jsx)("div",{className:"avatar round",style:a[c],children:Object(r.jsx)("img",{className:"round",style:{padding:"1px"},src:n,alt:""})})}}}]);