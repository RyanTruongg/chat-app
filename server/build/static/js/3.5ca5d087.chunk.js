(this["webpackJsonpchat-app"]=this["webpackJsonpchat-app"]||[]).push([[3],{100:function(t,e,n){"use strict";n(0);var r=n(2),o={small:{width:"28px",height:"28px"},medium:{width:"40px",height:"40px"},large:{width:"60px",height:"60px"}};e.a=function(t){var e=t.imgSrc,n=void 0===e?"https://i.pravatar.cc/300":e,a=t.size,c=void 0===a?"medium":a;return Object(r.jsx)("div",{className:"avatar round",style:o[c],children:Object(r.jsx)("img",{className:"round",style:{padding:"1px"},src:n,alt:""})})}},101:function(t,e,n){"use strict";var r=n(25),o=n(37),a=(n(0),n(2)),c=["iconName","variant","type","size","color","className"];e.a=function(t){var e=t.iconName,n=t.variant,i=t.type,s=t.size,u=t.color,l=t.className,m=Object(o.a)(t,c),f=["btn"];return null===l||void 0===l||l.split(" ").forEach((function(t){return f.push(t)})),"clear"===n&&f.push("btn--nobg"),"large"===s&&f.push("btn--large"),Object(a.jsx)("button",Object(r.a)(Object(r.a)({},m),{},{type:i,className:f.join(" "),children:Object(a.jsx)("span",{style:{color:u},className:"material-icons-round",children:e})}))}},109:function(t,e,n){"use strict";n.r(e);var r=n(25),o=n(38);var a=n(32);function c(t){return function(t){if(Array.isArray(t))return Object(a.a)(t)}(t)||function(t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||Object(o.a)(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var i=n(24),s=n(0),u=n(3),l=n(18),m=n(26),f=n(100),d=n(101),b=n(2),h=function(t){var e=t.photoURL,n=t.displayName;return Object(b.jsxs)("div",{className:"chatbox__header",children:[Object(b.jsxs)("div",{className:"left",children:[Object(b.jsx)(f.a,{imgSrc:e,size:"medium"}),Object(b.jsxs)("div",{className:"chatbox-info",children:[Object(b.jsx)("p",{className:"chatbox-info__name",children:n}),Object(b.jsx)("p",{className:"chatbox-info__status",children:"Active now"})]})]}),Object(b.jsxs)("div",{className:"right",children:[Object(b.jsx)(d.a,{variant:"clear",iconName:"phone_in_talk",color:"var(--pink300)"}),Object(b.jsx)(d.a,{variant:"clear",iconName:"video_call",color:"var(--pink300)"}),Object(b.jsx)(d.a,{variant:"clear",iconName:"more_horiz",color:"var(--pink300)"})]})]})},j=function(t){var e=t.msgText,n=t.className,r=t.self,o=t.roomPhotoURL;return Object(b.jsxs)("div",{className:n,children:[!r&&Object(b.jsx)(f.a,{size:"small",imgSrc:o}),Object(b.jsx)("div",{className:"msg-list",children:e&&e.map((function(t,e){return Object(b.jsx)("p",{children:t},e)}))})]})};n.e(5).then(n.t.bind(null,107,7));var v=function(t){var e=t.msgList,n=t.uid,r=t.roomPhotoURL,o=Object(s.useRef)(null);return Object(s.useEffect)((function(){o.current.scrollTop=o.current.scrollHeight}),[e]),Object(b.jsx)("div",{ref:o,className:"chatbox-msg-container",children:null===e||void 0===e?void 0:e.map((function(t,e){var o=(null===t||void 0===t?void 0:t.from)===n?"msg msg--mine":"msg",a=(null===t||void 0===t?void 0:t.from)===n;return Object(b.jsx)(j,{roomPhotoURL:r,self:a,msgText:null===t||void 0===t?void 0:t.msg,className:o},e)}))})},p=function(t){var e=t.roomID,n=t.uid,r=t.pushNewMsg,o=Object(s.useState)(""),a=Object(i.a)(o,2),c=a[0],u=a[1];Object(s.useEffect)((function(){return m.a.on("msg:create",(function(t){var e=t.success,n=t._doc;e&&r(n)})),function(){m.a.off("msg:create")}}),[r]);return Object(b.jsx)("div",{className:"chatbox-msg-input",children:Object(b.jsxs)("form",{onSubmit:function(t){if(t.preventDefault(),c.trim()){var r={from:n,to:e,content:c,timestamp:Date.now()};m.a.emit("msg:create",r)}u("")},children:[Object(b.jsx)("input",{type:"text",placeholder:"Aa",value:c,onChange:function(t){return u(t.target.value)}}),Object(b.jsx)(d.a,{variant:"clear",size:"large",iconName:"send",color:"var(--pink300)"})]})})};n.e(6).then(n.t.bind(null,106,7));var O=function(){var t,e=Object(s.useState)(null),n=Object(i.a)(e,2),a=n[0],f=n[1],d=Object(u.h)().roomID,j=Object(s.useState)([]),O=Object(i.a)(j,2),g=O[0],x=O[1],y=null===(t=Object(l.c)().user)||void 0===t?void 0:t.uid,N=Object(s.useCallback)((function(t){var e=c(g),n=e.pop();if(n){if((null===n||void 0===n?void 0:n.from)===(null===t||void 0===t?void 0:t.from))n.msg.push(t.content),e.push(n);else{var r={from:t.from,msg:[t.content]};e.push(n),e.push(r)}x(e)}else x([{from:t.from,msg:[t.content]}])}),[g]);Object(s.useEffect)((function(){fetch("/api/user/"+d).then((function(t){return t.json()})).then((function(t){f(t),console.log(t)})).catch((function(t){console.log(t)}))}),[d]),Object(s.useEffect)((function(){fetch("/api/message?from=".concat(y,"&to=").concat(d)).then((function(t){return t.json()})).then((function(t){var e=c(t).sort((function(t,e){return t.timestamp-e.timestamp})),n=w(e);x(n)}))}),[d,y]),Object(s.useEffect)((function(){return m.a.on("private msg",(function(t){t.from===d&&N(t)})),function(){m.a.off("private msg")}}),[N,d]);var w=function(t){var e,n=[],r={from:"",msg:[]},a=function(t,e){var n;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=Object(o.a)(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,a=function(){};return{s:a,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,i=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return i=t.done,t},e:function(t){s=!0,c=t},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw c}}}}(t=Array.from(t));try{for(a.s();!(e=a.n()).done;){var c=e.value;r.from?c.from!==r.from?(n.push(r),r={from:c.from,msg:[c.content]}):r.msg.push(c.content):(r.from=c.from,r.msg=[c.content])}}catch(i){a.e(i)}finally{a.f()}return r.from&&n.push(r),n};return a?Object(b.jsxs)("div",{className:"chatbox",children:[Object(b.jsx)(h,Object(r.a)({},a)),Object(b.jsx)(v,{roomPhotoURL:null===a||void 0===a?void 0:a.photoURL,uid:y,msgList:g}),Object(b.jsx)(p,{pushNewMsg:N,roomID:d,uid:y})]}):Object(b.jsx)("p",{children:"Loading..."})};e.default=O}}]);
//# sourceMappingURL=3.5ca5d087.chunk.js.map