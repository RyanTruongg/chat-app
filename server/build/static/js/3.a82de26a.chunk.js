(this["webpackJsonpchat-app"]=this["webpackJsonpchat-app"]||[]).push([[3],{101:function(t,e,n){"use strict";n(0);var r=n(2),o={small:{width:"28px",height:"28px"},medium:{width:"40px",height:"40px"},large:{width:"60px",height:"60px"}};e.a=function(t){var e=t.imgSrc,n=void 0===e?"https://i.pravatar.cc/300":e,a=t.size,c=void 0===a?"medium":a;return Object(r.jsx)("div",{className:"avatar round",style:o[c],children:Object(r.jsx)("img",{className:"round",style:{padding:"1px"},src:n,alt:""})})}},102:function(t,e,n){"use strict";var r=n(17),o=n(38),a=(n(0),n(2)),c=["iconName","variant","type","size","color","className"];e.a=function(t){var e=t.iconName,n=t.variant,i=t.type,s=t.size,u=t.color,l=t.className,m=Object(o.a)(t,c),f=["btn"];return null===l||void 0===l||l.split(" ").forEach((function(t){return f.push(t)})),"clear"===n&&f.push("btn--nobg"),"large"===s&&f.push("btn--large"),Object(a.jsx)("button",Object(r.a)(Object(r.a)({},m),{},{type:i,className:f.join(" "),children:Object(a.jsx)("span",{style:{color:u},className:"material-icons-round",children:e})}))}},110:function(t,e,n){"use strict";n.r(e);var r=n(17),o=n(39);var a=n(32);function c(t){return function(t){if(Array.isArray(t))return Object(a.a)(t)}(t)||function(t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||Object(o.a)(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var i=n(20),s=n(0),u=n(3),l=n(14),m=n(37),f=n(28),d=n(101),b=n(102),j=n(2),v=function(t){var e=t.photoURL,n=t.displayName;return Object(j.jsxs)("div",{className:"chatbox__header",children:[Object(j.jsxs)("div",{className:"left",children:[Object(j.jsx)(d.a,{imgSrc:e,size:"medium"}),Object(j.jsxs)("div",{className:"chatbox-info",children:[Object(j.jsx)("p",{className:"chatbox-info__name",children:n}),Object(j.jsx)("p",{className:"chatbox-info__status",children:"Active now"})]})]}),Object(j.jsxs)("div",{className:"right",children:[Object(j.jsx)(b.a,{variant:"clear",iconName:"phone_in_talk",color:"var(--pink300)"}),Object(j.jsx)(b.a,{variant:"clear",iconName:"video_call",color:"var(--pink300)"}),Object(j.jsx)(b.a,{variant:"clear",iconName:"more_horiz",color:"var(--pink300)"})]})]})},h=function(t){var e=t.msgText,n=t.className,r=t.self,o=t.roomPhotoURL;return Object(j.jsxs)("div",{className:n,children:[!r&&Object(j.jsx)(d.a,{size:"small",imgSrc:o}),Object(j.jsx)("div",{className:"msg-list",children:null===e||void 0===e?void 0:e.map((function(t,e){var n=t.content,r=t.timestamp,o=new Date(r).toLocaleString("en-GB",{timeZone:"UTC"});return Object(j.jsx)("p",{"data-time":o,children:n},e)}))})]})};n.e(5).then(n.t.bind(null,108,7));var p=function(t){var e=t.msgList,n=t.uid,r=t.roomPhotoURL,o=Object(s.useRef)(null);return Object(s.useEffect)((function(){o.current.scrollTop=o.current.scrollHeight}),[e]),Object(j.jsx)("div",{ref:o,className:"chatbox-msg-container",children:null===e||void 0===e?void 0:e.map((function(t,e){var o=(null===t||void 0===t?void 0:t.from)===n?"msg msg--mine":"msg",a=(null===t||void 0===t?void 0:t.from)===n;return Object(j.jsx)(h,{roomPhotoURL:r,self:a,msgText:null===t||void 0===t?void 0:t.msg,className:o},e)}))})},O=function(t){var e=t.roomID,n=t.uid,r=t.pushNewMsg,o=Object(s.useState)(""),a=Object(i.a)(o,2),c=a[0],u=a[1],l=Object(m.b)().updateContactLastMsg;Object(s.useEffect)((function(){return f.a.on("msg:create",(function(t){var e=t.success,n=t.doc;e&&(r(n),l(n.to,n))})),function(){f.a.off("msg:create")}}),[r,l]);return Object(j.jsx)("div",{className:"chatbox-msg-input",children:Object(j.jsxs)("form",{onSubmit:function(t){if(t.preventDefault(),c.trim()){var r={from:n,to:e,content:c};f.a.emit("msg:create",r)}u("")},children:[Object(j.jsx)("input",{type:"text",placeholder:"Aa",value:c,onChange:function(t){return u(t.target.value)}}),Object(j.jsx)(b.a,{variant:"clear",size:"large",iconName:"send",color:"var(--pink300)"})]})})};n.e(6).then(n.t.bind(null,107,7));var g=function(){var t,e=Object(s.useState)(null),n=Object(i.a)(e,2),a=n[0],d=n[1],b=Object(u.h)().roomID,h=Object(s.useState)([]),g=Object(i.a)(h,2),x=g[0],y=g[1],N=null===(t=Object(l.c)().user)||void 0===t?void 0:t.uid,w=Object(m.b)().updateContactLastMsg,S=Object(s.useCallback)((function(t){var e=c(x),n=e.pop(),r={timestamp:t.timestamp,content:t.content};if(n){if((null===n||void 0===n?void 0:n.from)===(null===t||void 0===t?void 0:t.from))n.msg.push(r),e.push(n);else{var o={from:t.from,msg:[r]};e.push(n),e.push(o)}y(e)}else y([{from:t.from,msg:[r]}])}),[x]);Object(s.useEffect)((function(){fetch("/api/user/"+b).then((function(t){return t.json()})).then((function(t){d(t)})).catch((function(t){console.log(t)}))}),[b]),Object(s.useEffect)((function(){fetch("/api/message?from=".concat(N,"&to=").concat(b)).then((function(t){return t.json()})).then((function(t){var e=c(t).sort((function(t,e){return t.timestamp-e.timestamp})),n=L(e);y(n)}))}),[b,N]),Object(s.useEffect)((function(){return f.a.on("private msg",(function(t){var e=t.doc;e.from===b&&S(e),w(e.from,e)})),function(){f.a.off("private msg")}}),[S,b,w]);var L=function(t){var e,n=[],r={from:"",msg:[]},a=function(t,e){var n;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=Object(o.a)(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,a=function(){};return{s:a,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,i=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return i=t.done,t},e:function(t){s=!0,c=t},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw c}}}}(t=Array.from(t));try{for(a.s();!(e=a.n()).done;){var c=e.value,i={timestamp:c.timestamp,content:c.content};r.from?c.from!==r.from?(n.push(r),r={from:c.from,msg:[i]}):r.msg.push(i):(r.from=c.from,r.msg=[i])}}catch(s){a.e(s)}finally{a.f()}return r.from&&n.push(r),n};return(null===a||void 0===a?void 0:a.uid)===b?Object(j.jsxs)("div",{className:"chatbox",children:[Object(j.jsx)(v,Object(r.a)({},a)),Object(j.jsx)(p,{roomPhotoURL:null===a||void 0===a?void 0:a.photoURL,uid:N,msgList:x}),Object(j.jsx)(O,{pushNewMsg:S,roomID:b,uid:N})]}):Object(j.jsx)("p",{children:"Loading..."})};e.default=g}}]);