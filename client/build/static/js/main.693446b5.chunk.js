(this["webpackJsonpchat-app"]=this["webpackJsonpchat-app"]||[]).push([[2],{13:function(t,n,e){"use strict";e.d(n,"b",(function(){return f})),e.d(n,"c",(function(){return j})),e.d(n,"a",(function(){return b}));var c=e(15),r=e(37),u=e(16),o=e(0),i=e.n(o),a=e(2),s=e(25),l=e(1),d=["children"],h=i.a.createContext();function f(t){var n=t.children,c=function(){var t=Object(o.useState)(null),n=Object(u.a)(t,2),c=n[0],r=n[1],i=Object(o.useState)("listening"),a=Object(u.a)(i,2),l=a[0],d=a[1];return Object(o.useEffect)((function(){return Promise.all([e.e(0),e.e(1)]).then(e.bind(null,17)).then((function(t){var n=t.default.auth().onAuthStateChanged((function(t){return t?(r(t),d("loged")):(r(null),d("notloged"),s.a.disconnect()),n}))}))}),[]),Object(o.useEffect)((function(){Promise.all([e.e(0),e.e(1)]).then(e.bind(null,17)).then((function(t){var n=t.default;n.auth().getRedirectResult().then((function(t){var e;t.additionalUserInfo.isNewUser&&(null===(e=n.auth().currentUser)||void 0===e||e.getIdToken(!0).then((function(n){fetch("/api/user",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+n},body:JSON.stringify({uid:t.user.uid})}).catch((function(t){return console.log(t)}))})))})).catch((function(t){}))}))}),[]),Object(o.useEffect)((function(){"loged"===l&&c&&Promise.all([e.e(0),e.e(1)]).then(e.bind(null,17)).then((function(t){var n;null===(n=t.default.auth().currentUser)||void 0===n||n.getIdToken(!0).then((function(t){s.a.auth={idToken:t},s.a.connect()}))}))}),[c,l]),{loginState:l,user:c,signin:function(){Promise.all([e.e(0),e.e(1)]).then(e.bind(null,17)).then((function(t){var n=t.default,e=new n.auth.GoogleAuthProvider;n.auth().signInWithRedirect(e)}))},signout:function(){Promise.all([e.e(0),e.e(1)]).then(e.bind(null,17)).then((function(t){t.default.auth().signOut().then((function(){return r(null)}))}))}}}();return Object(l.jsx)(h.Provider,{value:c,children:n})}function j(){return Object(o.useContext)(h)}function b(t){var n=t.children,e=Object(r.a)(t,d),u=j();return Object(l.jsx)(a.b,Object(c.a)(Object(c.a)({},e),{},{render:function(t){var e=t.location;switch(u.loginState){case"listening":return Object(l.jsx)("p",{children:"Authenticating..."});case"loged":return n;case"notloged":return Object(l.jsx)(a.a,{to:{pathname:"/login",state:{from:e}}});default:return Object(l.jsx)("p",{children:"Error"})}}}))}},25:function(t,n,e){"use strict";var c=e(55),r=Object(c.io)("https://msg-chatapp.herokuapp.com/",{autoConnect:!1});r.on("connect_error",(function(){console.log("connect_error")})),n.a=r},35:function(t,n,e){"use strict";e.d(n,"a",(function(){return d})),e.d(n,"b",(function(){return h}));var c=e(15),r=e(26),u=e(16),o=e(0),i=e.n(o),a=e(13),s=e(1),l=i.a.createContext(),d=function(t){var n=t.children,e=f();return Object(s.jsx)(l.Provider,{value:e,children:n})},h=function(){return Object(o.useContext)(l)},f=function(){var t,n=Object(o.useState)([]),i=Object(u.a)(n,2),s=i[0],l=i[1],d=Object(a.c)();function h(t){return Object(r.a)(t).sort((function(t,n){return n.lastMsg.timestamp-t.lastMsg.timestamp}))}return Object(o.useEffect)((function(){d.user&&Promise.all([e.e(0),e.e(1)]).then(e.bind(null,17)).then((function(t){t.default.auth().currentUser.getIdToken(!0).then((function(t){var n,e={Authorization:"Bearer "+t},c="/api/contacts/"+(null===(n=d.user)||void 0===n?void 0:n.uid);fetch(c,{headers:e}).then((function(t){return t.json()})).then((function(t){return l(h(t))})).catch((function(t){return console.log(t)}))}))}))}),[d.user,null===(t=d.user)||void 0===t?void 0:t.uid]),{data:s,setContactList:l,updateContact:function(t){var n=[];n=s.some((function(n){return n.contactID===t.contactID}))?Object(r.a)(s).map((function(n){return n.contactID===t.contactID?t:n})):[].concat(Object(r.a)(s),[t]),l(h(n))},updateSeen:function(t){var n=s.map((function(n){if(n.contactID===t){if(!n.seen){var e,r={contactID:t,userID:null===(e=d.user)||void 0===e?void 0:e.uid};fetch("/api/contacts/update-seen",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).catch((function(t){return console.log(t)}))}return Object(c.a)(Object(c.a)({},n),{},{seen:!0})}return n}));l(n)}}}},96:function(t,n,e){},97:function(t,n,e){},98:function(t,n,e){"use strict";e.r(n);var c=e(0),r=e.n(c),u=e(54),o=e.n(u),i=e(27),a=e(2),s=e(13),l=e(35),d=e(1),h=r.a.lazy((function(){return e.e(5).then(e.bind(null,110))})),f=r.a.lazy((function(){return e.e(6).then(e.bind(null,111))}));var j=function(){return Object(d.jsx)("div",{className:"app",children:Object(d.jsx)(s.b,{children:Object(d.jsxs)(i.a,{children:[Object(d.jsx)(a.b,{exact:!0,path:"/login",children:Object(d.jsx)(c.Suspense,{fallback:Object(d.jsx)("div",{children:"Loading..."}),children:Object(d.jsx)(f,{})})}),Object(d.jsx)(s.a,{exact:!0,path:"/",children:Object(d.jsx)(a.a,{to:"home"})}),Object(d.jsx)(s.a,{path:"/home",children:Object(d.jsx)(l.a,{children:Object(d.jsx)(c.Suspense,{fallback:Object(d.jsx)("div",{children:"Loading..."}),children:Object(d.jsx)(h,{})})})})]})})})},b=function(t){t&&t instanceof Function&&e.e(7).then(e.bind(null,109)).then((function(n){var e=n.getCLS,c=n.getFID,r=n.getFCP,u=n.getLCP,o=n.getTTFB;e(t),c(t),r(t),u(t),o(t)}))};e(96),e(97);o.a.render(Object(d.jsx)(r.a.StrictMode,{children:Object(d.jsx)(j,{})}),document.getElementById("root")),b()}},[[98,3,4]]]);