(this["webpackJsonpchat-app"]=this["webpackJsonpchat-app"]||[]).push([[0],{104:function(e,t,n){},105:function(e,t,n){},106:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),c=n(28),s=n.n(c),u=n(31),i=n(3),o=n(24),d=n(2),f=a.a.lazy((function(){return n.e(3).then(n.bind(null,119))})),l=a.a.lazy((function(){return n.e(5).then(n.bind(null,120))}));var h=function(){return Object(d.jsx)("div",{className:"app",children:Object(d.jsx)(o.b,{children:Object(d.jsxs)(u.a,{children:[Object(d.jsx)(i.b,{exact:!0,path:"/login",children:Object(d.jsx)(r.Suspense,{fallback:Object(d.jsx)("div",{children:"Loading..."}),children:Object(d.jsx)(l,{})})}),Object(d.jsx)(o.a,{exact:!0,path:"/",children:Object(d.jsx)(i.a,{to:"home"})}),Object(d.jsx)(o.a,{path:"/home",children:Object(d.jsx)(r.Suspense,{fallback:Object(d.jsx)("div",{children:"Loading..."}),children:Object(d.jsx)(f,{})})})]})})})},p=function(e){e&&e instanceof Function&&n.e(7).then(n.bind(null,118)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,c=t.getLCP,s=t.getTTFB;n(e),r(e),a(e),c(e),s(e)}))},b=n(6),j=n(61),v=n(62),g=n(60),O=Object(b.a)({reducer:{conversations:j.b,messages:v.b,users:g.a}}),x=n(42);n(104),n(105);s.a.render(Object(d.jsx)(a.a.StrictMode,{children:Object(d.jsx)(x.a,{store:O,children:Object(d.jsx)(h,{})})}),document.getElementById("root")),p()},16:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(4),a=n.n(r),c=n(20),s=n(15),u=n(17);function i(e){return o.apply(this,arguments)}function o(){return(o=Object(s.a)(a.a.mark((function e(t){var n,r,i,o=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=o.length>1&&void 0!==o[1]?o[1]:{},e.next=3,u.a;case 3:return i=e.sent,e.abrupt("return",null===(n=i.auth().currentUser)||void 0===n?void 0:n.getIdToken(!1).then(function(){var e=Object(s.a)(a.a.mark((function e(n){var s,u;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s={Authorization:"Bearer "+n,"Content-Type":"application/json"},e.next=3,fetch(t,Object(c.a)(Object(c.a)({},r),{},{headers:s}));case 3:return u=e.sent,e.next=6,u.json();case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},17:function(e,t,n){"use strict";t.a=Promise.all([n.e(4),n.e(6)]).then(n.bind(null,107)).then((function(e){return e.default}))},24:function(e,t,n){"use strict";n.d(t,"b",(function(){return b})),n.d(t,"c",(function(){return j})),n.d(t,"a",(function(){return v}));var r=n(20),a=n(44),c=n(32),s=n(0),u=n.n(s),i=n(3),o=n(25),d=n(17),f=n(30),l=n(2),h=["children"],p=u.a.createContext();function b(e){var t=e.children,n=function(){var e=Object(s.useState)(null),t=Object(c.a)(e,2),n=t[0],r=t[1],a=Object(s.useState)("listening"),u=Object(c.a)(a,2),i=u[0],l=u[1];return Object(s.useEffect)((function(){return d.a.then((function(e){var t=e.auth().onAuthStateChanged((function(e){return e?(r(e),l("loged")):(r(null),l("notloged"),o.a.disconnect()),t}))}))}),[]),Object(s.useEffect)((function(){d.a.then((function(e){e.auth().getRedirectResult().then((function(e){e.additionalUserInfo.isNewUser&&f.a.createNewUser(e.user.uid).then((function(){return console.log("New user created")}))})).catch((function(e){}))}))}),[]),Object(s.useEffect)((function(){"loged"===i&&n&&d.a.then((function(e){var t;null===(t=e.auth().currentUser)||void 0===t||t.getIdToken(!0).then((function(e){o.a.auth={idToken:e},o.a.connect()}))}))}),[n,i]),{loginState:i,user:n,signin:function(){d.a.then((function(e){var t=new e.auth.GoogleAuthProvider;e.auth().signInWithRedirect(t)}))},signout:function(){d.a.then((function(e){e.auth().signOut().then((function(){return r(null)}))}))}}}();return Object(l.jsx)(p.Provider,{value:n,children:t})}function j(){return Object(s.useContext)(p)}function v(e){var t=e.children,n=Object(a.a)(e,h),c=j();return Object(l.jsx)(i.b,Object(r.a)(Object(r.a)({},n),{},{render:function(e){var n=e.location;switch(c.loginState){case"listening":return Object(l.jsx)("p",{children:"Authenticating..."});case"loged":return t;case"notloged":return Object(l.jsx)(i.a,{to:{pathname:"/login",state:{from:n}}});default:return Object(l.jsx)("p",{children:"Error"})}}}))}},25:function(e,t,n){"use strict";var r=n(63),a=Object(r.io)("https://msg-chatapp.herokuapp.com/",{autoConnect:!1});a.on("connect_error",(function(){console.log("connect_error")})),t.a=a},30:function(e,t,n){"use strict";var r=n(16),a={createNewUser:function(e){var t={method:"POST",body:JSON.stringify({uid:e})};return Object(r.a)("/api/user/",t)},fetchUserById:function(e){return Object(r.a)("/api/user/"+e)}};t.a=a},60:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return f}));var r=n(4),a=n.n(r),c=n(15),s=n(6),u=n(30),i=Object(s.b)("users/fetchUserById",function(){var e=Object(c.a)(a.a.mark((function e(t,n){var r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.a.fetchUserById(t);case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),{condition:function(e,t){var n=(0,t.getState)().users.requests[e];if("fulfilled"===n||"pending"===n)return!1}}),o=Object(s.c)({selectId:function(e){return e.uid}}),d=Object(s.d)({name:"users",initialState:o.getInitialState({status:"idle",requests:{}}),reducers:{},extraReducers:function(e){e.addCase(i.pending,(function(e,t){e.requests[t.meta.arg]="pending"})),e.addCase(i.fulfilled,(function(e,t){o.addOne(e,t.payload),e.requests[t.meta.arg]="fulfilled"}))}}),f=o.getSelectors((function(e){return e.users}));t.a=d.reducer},61:function(e,t,n){"use strict";n.d(t,"c",(function(){return o})),n.d(t,"d",(function(){return d})),n.d(t,"a",(function(){return h})),n.d(t,"e",(function(){return p}));var r=n(4),a=n.n(r),c=n(15),s=n(6),u=n(16),i={fetchAllConversationsOfUser:function(e){return Object(u.a)("/api/conversations/"+e)},markAsRead:function(e,t){var n={uid:e,conversationID:t};return Object(u.a)("/api/conversations/update-seen",{method:"PUT",body:JSON.stringify(n)})}},o=Object(s.b)("conversations/fetchAllConversations",function(){var e=Object(c.a)(a.a.mark((function e(t,n){var r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.fetchAllConversationsOfUser(t);case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),{condition:function(e,t){var n=(0,t.getState)().conversations;if("pending"===n.status||"fulfilled"===n.status)return!1}}),d=Object(s.b)("conversations/markAsRead",function(){var e=Object(c.a)(a.a.mark((function e(t,n){var r,c,s;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.uid,c=t.conversationID,e.next=3,i.markAsRead(r,c);case 3:return s=e.sent,e.abrupt("return",{res:s,conversationID:c});case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),f=Object(s.d)({name:"conversations",initialState:{data:[],status:"idle"},reducers:{addConversations:function(e,t){e.data.push(t.payload)},updateLastMsg:function(e,t){var n=t.payload,r=n.conversationIndex,a=n.lastMsg;e.data[r].lastMsg=a,e.data[r].seen=!1}},extraReducers:function(e){e.addCase(o.pending,(function(e,t){"idle"===e.status&&(e.status="pending")})),e.addCase(o.fulfilled,(function(e,t){"pending"===e.status&&(e.status="fulfilled"),e.data=t.payload})),e.addCase(d.fulfilled,(function(e,t){e.data.find((function(e){return e.info._id===t.payload.conversationID})).seen=!0}))}}),l=f.actions,h=l.addConversations,p=l.updateLastMsg;t.b=f.reducer},62:function(e,t,n){"use strict";n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return f}));var r=n(4),a=n.n(r),c=n(15),s=n(6),u=n(16),i={fetchMessages:function(e,t){return Object(u.a)("/api/message?uid=".concat(e,"&conversationID=").concat(t))}},o=Object(s.b)("messages/fetchMessages",function(){var e=Object(c.a)(a.a.mark((function e(t,n){var r,c,s;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.uid,c=t.conversationID,e.next=3,i.fetchMessages(r,c);case 3:return s=e.sent,e.abrupt("return",{messages:s,conversationID:c});case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),d=Object(s.d)({name:"messages",initialState:{data:{}},reducers:{addMessage:function(e,t){var n=t.payload,r=n.conversationID,a=n.message;e.data[r]&&e.data[r].messages.push(a)}},extraReducers:function(e){e.addCase(o.fulfilled,(function(e,t){e.data[t.payload.conversationID]={status:"fulfilled",messages:t.payload.messages}}))}}),f=d.actions.addMessage;t.b=d.reducer}},[[106,1,2]]]);