(this["webpackJsonpchat-app"]=this["webpackJsonpchat-app"]||[]).push([[0],{102:function(t,e,n){},103:function(t,e,n){},104:function(t,e,n){"use strict";n.r(e);var a=n(0),r=n.n(a),c=n(27),s=n.n(c),u=n(30),i=n(3),o=n(24),d=n(2),f=r.a.lazy((function(){return n.e(3).then(n.bind(null,117))})),l=r.a.lazy((function(){return n.e(5).then(n.bind(null,118))}));var h=function(){return Object(d.jsx)("div",{className:"app",children:Object(d.jsx)(o.b,{children:Object(d.jsxs)(u.a,{children:[Object(d.jsx)(i.b,{exact:!0,path:"/login",children:Object(d.jsx)(a.Suspense,{fallback:Object(d.jsx)("div",{children:"Loading..."}),children:Object(d.jsx)(l,{})})}),Object(d.jsx)(o.a,{exact:!0,path:"/",children:Object(d.jsx)(i.a,{to:"home"})}),Object(d.jsx)(o.a,{path:"/home",children:Object(d.jsx)(a.Suspense,{fallback:Object(d.jsx)("div",{children:"Loading..."}),children:Object(d.jsx)(f,{})})})]})})})},p=function(t){t&&t instanceof Function&&n.e(7).then(n.bind(null,116)).then((function(e){var n=e.getCLS,a=e.getFID,r=e.getFCP,c=e.getLCP,s=e.getTTFB;n(t),a(t),r(t),c(t),s(t)}))},b=n(14),j=n(59),v=n(60),g=Object(b.a)({reducer:{conversations:j.b,messages:v.b}}),O=n(42);n(102),n(103);s.a.render(Object(d.jsx)(r.a.StrictMode,{children:Object(d.jsx)(O.a,{store:g,children:Object(d.jsx)(h,{})})}),document.getElementById("root")),p()},16:function(t,e,n){"use strict";e.a=Promise.all([n.e(4),n.e(6)]).then(n.bind(null,105)).then((function(t){return t.default}))},17:function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var a=n(5),r=n.n(a),c=n(20),s=n(15),u=n(16);function i(t){return o.apply(this,arguments)}function o(){return(o=Object(s.a)(r.a.mark((function t(e){var n,a,i,o=arguments;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=o.length>1&&void 0!==o[1]?o[1]:{},t.next=3,u.a;case 3:return i=t.sent,t.abrupt("return",null===(n=i.auth().currentUser)||void 0===n?void 0:n.getIdToken(!1).then(function(){var t=Object(s.a)(r.a.mark((function t(n){var s,u;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s={Authorization:"Bearer "+n,"Content-Type":"application/json"},t.next=3,fetch(e,Object(c.a)(Object(c.a)({},a),{},{headers:s}));case 3:return u=t.sent,t.next=6,u.json();case 6:return t.abrupt("return",t.sent);case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}},24:function(t,e,n){"use strict";n.d(e,"b",(function(){return j})),n.d(e,"c",(function(){return v})),n.d(e,"a",(function(){return g}));var a=n(20),r=n(43),c=n(31),s=n(0),u=n.n(s),i=n(3),o=n(28),d=n(16),f=n(17),l={createNewUser:function(t){var e={method:"POST",body:JSON.stringify({uid:t})};return Object(f.a)("/api/user/",e)}},h=n(2),p=["children"],b=u.a.createContext();function j(t){var e=t.children,n=function(){var t=Object(s.useState)(null),e=Object(c.a)(t,2),n=e[0],a=e[1],r=Object(s.useState)("listening"),u=Object(c.a)(r,2),i=u[0],f=u[1];return Object(s.useEffect)((function(){return d.a.then((function(t){var e=t.auth().onAuthStateChanged((function(t){return t?(a(t),f("loged")):(a(null),f("notloged"),o.a.disconnect()),e}))}))}),[]),Object(s.useEffect)((function(){d.a.then((function(t){t.auth().getRedirectResult().then((function(t){t.additionalUserInfo.isNewUser&&l.createNewUser(t.user.uid).then((function(){return console.log("New user created")}))})).catch((function(t){}))}))}),[]),Object(s.useEffect)((function(){"loged"===i&&n&&d.a.then((function(t){var e;null===(e=t.auth().currentUser)||void 0===e||e.getIdToken(!0).then((function(t){o.a.auth={idToken:t},o.a.connect()}))}))}),[n,i]),{loginState:i,user:n,signin:function(){d.a.then((function(t){var e=new t.auth.GoogleAuthProvider;t.auth().signInWithRedirect(e)}))},signout:function(){d.a.then((function(t){t.auth().signOut().then((function(){return a(null)}))}))}}}();return Object(h.jsx)(b.Provider,{value:n,children:e})}function v(){return Object(s.useContext)(b)}function g(t){var e=t.children,n=Object(r.a)(t,p),c=v();return Object(h.jsx)(i.b,Object(a.a)(Object(a.a)({},n),{},{render:function(t){var n=t.location;switch(c.loginState){case"listening":return Object(h.jsx)("p",{children:"Authenticating..."});case"loged":return e;case"notloged":return Object(h.jsx)(i.a,{to:{pathname:"/login",state:{from:n}}});default:return Object(h.jsx)("p",{children:"Error"})}}}))}},28:function(t,e,n){"use strict";var a=n(61),r=Object(a.io)("https://msg-chatapp.herokuapp.com/",{autoConnect:!1});r.on("connect_error",(function(){console.log("connect_error")})),e.a=r},59:function(t,e,n){"use strict";n.d(e,"c",(function(){return o})),n.d(e,"d",(function(){return d})),n.d(e,"a",(function(){return h})),n.d(e,"e",(function(){return p}));var a=n(5),r=n.n(a),c=n(15),s=n(14),u=n(17),i={fetchAllConversationsOfUser:function(t){return console.log("a"),Object(u.a)("/api/conversations/"+t)},markAsRead:function(t,e){var n={uid:t,conversationID:e};return Object(u.a)("/api/conversations/update-seen",{method:"PUT",body:JSON.stringify(n)})}},o=Object(s.b)("conversations/fetchAllConversations",function(){var t=Object(c.a)(r.a.mark((function t(e,n){var a;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,i.fetchAllConversationsOfUser(e);case 2:return a=t.sent,t.abrupt("return",a);case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),{condition:function(t,e){var n=(0,e.getState)().conversations;if("pending"===n.status||"fulfilled"===n.status)return!1}}),d=Object(s.b)("conversations/markAsRead",function(){var t=Object(c.a)(r.a.mark((function t(e,n){var a,c,s;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=e.uid,c=e.conversationID,t.next=3,i.markAsRead(a,c);case 3:return s=t.sent,t.abrupt("return",{res:s,conversationID:c});case 5:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()),f=Object(s.c)({name:"conversations",initialState:{data:[],status:"idle"},reducers:{addConversations:function(t,e){t.data.push(e.payload)},updateLastMsg:function(t,e){var n=e.payload,a=n.conversationIndex,r=n.lastMsg;t.data[a].lastMsg=r,t.data[a].seen=!1}},extraReducers:function(t){t.addCase(o.pending,(function(t,e){"idle"===t.status&&(t.status="pending")})),t.addCase(o.fulfilled,(function(t,e){"pending"===t.status&&(t.status="fulfilled"),t.data=e.payload})),t.addCase(d.fulfilled,(function(t,e){t.data.find((function(t){return t.info._id===e.payload.conversationID})).seen=!0}))}}),l=f.actions,h=l.addConversations,p=l.updateLastMsg;e.b=f.reducer},60:function(t,e,n){"use strict";n.d(e,"c",(function(){return o})),n.d(e,"a",(function(){return f}));var a=n(5),r=n.n(a),c=n(15),s=n(14),u=n(17),i={fetchMessages:function(t,e){return Object(u.a)("/api/message?uid=".concat(t,"&conversationID=").concat(e))}},o=Object(s.b)("messages/fetchMessages",function(){var t=Object(c.a)(r.a.mark((function t(e,n){var a,c,s;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=e.uid,c=e.conversationID,t.next=3,i.fetchMessages(a,c);case 3:return s=t.sent,t.abrupt("return",{messages:s,conversationID:c});case 5:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()),d=Object(s.c)({name:"messages",initialState:{data:{}},reducers:{addMessage:function(t,e){var n=e.payload,a=n.conversationID,r=n.message;t.data[a]&&t.data[a].messages.push(r)}},extraReducers:function(t){t.addCase(o.fulfilled,(function(t,e){t.data[e.payload.conversationID]={status:"fulfilled",messages:e.payload.messages}}))}}),f=d.actions.addMessage;e.b=d.reducer}},[[104,1,2]]]);