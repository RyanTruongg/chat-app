(this["webpackJsonpchat-app"]=this["webpackJsonpchat-app"]||[]).push([[3],{108:function(e,t,n){},109:function(e,t,n){},110:function(e,t,n){},117:function(e,t,n){"use strict";n.r(t);var r=n(30),a=n(3),o=n(24),i=n(31),s=n(0),c=n.p+"static/media/search.ffb58015.svg",l=n(2),u={small:{flex:"0 0 28px",height:"28px"},medium:{flex:"0 0 40px",height:"40px"},large:{flex:"0 0 60px",height:"60px"}},d=function(e){var t=e.imgSrc,n=void 0===t?"https://i.pravatar.cc/300":t,r=e.size,a=void 0===r?"medium":r;return Object(l.jsx)("div",{className:"avatar round",style:u[a],children:Object(l.jsx)("img",{className:"round",style:{padding:"1px"},src:n,alt:""})})},m=n(20),j=n(43),v=["iconName","variant","type","size","color","className"],f=function(e){var t=e.iconName,n=e.variant,r=e.type,a=e.size,o=e.color,i=e.className,s=Object(j.a)(e,v),c=["btn"];return null===i||void 0===i||i.split(" ").forEach((function(e){return c.push(e)})),"clear"===n&&c.push("btn--nobg"),"large"===a&&c.push("btn--large"),Object(l.jsx)("button",Object(m.a)(Object(m.a)({},s),{},{type:r,className:c.join(" "),children:Object(l.jsx)("span",{style:{color:o},className:"material-icons-round",children:t})}))};function b(){var e=Object(s.useState)(""),t=Object(i.a)(e,2),n=t[0],r=t[1];return Object(l.jsxs)(l.Fragment,{children:[Object(l.jsx)("input",{type:"text",placeholder:"Search messenger",value:n,onChange:function(e){return r(e.target.value)}}),!n&&Object(l.jsx)("img",{src:c,alt:""})]})}var h=function(e){var t=e.providerData,n=e.setOpen,r=e.open,a=Object(s.useState)(!1),c=Object(i.a)(a,2),u=c[0],m=c[1],j=Object(o.c)(),v=(t||{}).photoURL;return Object(l.jsxs)("header",{className:"sidebar-header",children:[Object(l.jsxs)("div",{className:"sidebar-top",children:[Object(l.jsxs)("div",{className:"sidebar-top-left",children:[Object(l.jsx)(d,{imgSrc:v}),Object(l.jsx)("span",{children:"Chats"})]}),Object(l.jsxs)("div",{className:"sidebar-top-right",children:[Object(l.jsx)(f,{iconName:"more_horiz",title:"More"}),Object(l.jsx)(f,{iconName:u?"fullscreen_exit":"fullscreen",onClick:function(){var e=document.getElementById("root");document.fullscreenElement?(m(!1),document.exitFullscreen()):e.requestFullscreen().then((function(){return m(!0)})).catch((function(e){alert("Error attempting to enable full-screen mode: ".concat(e.message," (").concat(e.name,")"))}))}}),Object(l.jsx)(f,{iconName:"logout",title:"Signout",onClick:j.signout}),r&&Object(l.jsx)(f,{iconName:"arrow_back",color:"var(--primary)",onClick:function(){return n(!1)}})]})]}),Object(l.jsx)("div",{className:"sidebar-bottom",children:Object(l.jsx)(b,{})})]})},p=n(37);var O=n(41);function x(e){return function(e){if(Array.isArray(e))return Object(p.a)(e)}(e)||function(e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||Object(O.a)(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var g=n(42),N=n(59);function y(){var e,t=Object(g.c)((function(e){return e.conversations.data})),n=x(t);n.sort((function(e,t){return t.lastMsg.timestamp-e.lastMsg.timestamp}));var r=Object(g.c)((function(e){return e.conversations.status})),a=Object(g.b)(),i=Object(o.c)();return Object(s.useEffect)((function(){var e;"idle"===r&&a(Object(N.c)(null===(e=i.user)||void 0===e?void 0:e.uid))}),[null===(e=i.user)||void 0===e?void 0:e.uid,a,r]),{data:n,updateConversation:function(e){var n=t.findIndex((function(t){return t.info._id===e.info._id}));a(-1===n?Object(N.a)(e):Object(N.e)({conversationIndex:n,lastMsg:e.lastMsg}))},markConversationAsRead:function(e){var n,r;(null===(n=t.find((function(t){return t.info._id===e})))||void 0===n?void 0:n.seen)||a(Object(N.d)({uid:null===(r=i.user)||void 0===r?void 0:r.uid,conversationID:e}))},getConversationInfo:function(e){var n=t.find((function(t){return t.info._id===e}));if(n)return n.info}}}var _=function(e){var t={},n=Date.now()-e;t.seconds=Math.floor(n/1e3),t.minutes=Math.floor(t.seconds/60),t.hours=Math.floor(t.minutes/60),t.days=Math.floor(t.hours/24),t.weeks=Math.floor(t.days/7),t.months=Math.floor(t.weeks/4),t.years=Math.floor(t.months/12);var r="Just now";for(var a in t){if(!(t[a]>0))return r;r="".concat(t[a]," ").concat(t[a]>1?a:a.split("s")[0])}},M=function(e){var t,n=e.info,c=e.seen,u=e.lastMsg,m=e.to,j=e.setOpen,v=n._id,f=n.displayName,b=n.photoURL,h=Object(s.useState)(_(u.timestamp)),p=Object(i.a)(h,2),O=p[0],x=p[1],g=Object(a.g)(),N=Object(o.c)(),M=y().markConversationAsRead;Object(s.useEffect)((function(){x(_(u.timestamp));var e=setInterval((function(){x(_(u.timestamp))}),6e4);return function(){return clearInterval(e)}}),[u.timestamp]);return Object(l.jsxs)(r.b,{onClick:function(){M(v),j(!1)},to:m,className:m===g.pathname?"room-title__card active":"room-title__card",children:[Object(l.jsx)(d,{imgSrc:b,size:"large"}),Object(l.jsxs)("div",{className:"room-title__card-info",children:[Object(l.jsx)("p",{children:f}),Object(l.jsxs)("div",{style:{fontWeight:!c&&"600"},className:"last-msg",children:[Object(l.jsx)("span",{children:(null===(t=N.user)||void 0===t?void 0:t.uid)===(null===u||void 0===u?void 0:u.from)?"You: "+(null===u||void 0===u?void 0:u.content):null===u||void 0===u?void 0:u.content}),Object(l.jsx)("span",{children:O})]})]})]})},w=["info","lastMsg","seen"],I=function(e){var t=e.data,n=e.setOpen;return Object(l.jsx)("div",{className:"room-title__list",children:null===t||void 0===t?void 0:t.map((function(e){var t=e.info,r=e.lastMsg,a=e.seen,o=Object(j.a)(e,w);return Object(l.jsx)(M,Object(m.a)({seen:a,info:t,lastMsg:r,to:"/home/t/"+t._id,setOpen:n},o),t._id)}))})},S=(n(108),function(){var e,t=Object(s.useState)(!1),n=Object(i.a)(t,2),r=n[0],a=n[1],c=Object(o.c)(),u=y();return Object(s.useEffect)((function(){window.matchMedia("(max-width: 768px)").matches&&a(!0)}),[]),Object(l.jsxs)("div",{className:"sidebar",style:{transform:r&&"translateX(0px)"},children:[Object(l.jsx)(h,{open:r,setOpen:a,providerData:null===(e=c.user)||void 0===e?void 0:e.providerData[0]}),Object(l.jsx)(I,{setOpen:a,data:u.data}),!r&&Object(l.jsx)(f,{className:"sidebar-open",type:"button",variant:"clear",size:"large",iconName:"menu",color:"var(--primary)",onClick:function(){return a(!0)}})]})}),D=function(e){var t=e.photoURL,n=e.displayName;return Object(l.jsxs)("div",{className:"chat__header",children:[Object(l.jsxs)("div",{className:"left",children:[Object(l.jsx)(d,{imgSrc:t,size:"medium"}),Object(l.jsxs)("div",{className:"chat-info",children:[Object(l.jsx)("p",{className:"chat-info__name",children:n}),Object(l.jsx)("p",{className:"chat-info__status",children:"Active now"})]})]}),Object(l.jsxs)("div",{className:"right",children:[Object(l.jsx)(f,{variant:"clear",iconName:"phone_in_talk",color:"var(--primary)"}),Object(l.jsx)(f,{variant:"clear",iconName:"video_call",color:"var(--primary)"}),Object(l.jsx)(f,{variant:"clear",iconName:"more_horiz",color:"var(--primary)"})]})]})},C=function(e){var t=e.msgText,n=e.className,r=e.self,a=e.roomPhotoURL;return Object(l.jsxs)("div",{className:n,children:[!r&&Object(l.jsx)(d,{size:"small",imgSrc:a}),Object(l.jsx)("div",{className:"msg-list",children:null===t||void 0===t?void 0:t.map((function(e,t){var n=e.content,r=e.timestamp,a=new Date(r-6e4*(new Date).getTimezoneOffset()).toLocaleString("en-GB",{timeZone:"UTC"});return Object(l.jsx)("p",{"data-time":a,children:n},t)}))})]})},L=(n(109),function(e){var t=e.msgList,n=e.uid,r=e.roomPhotoURL,a=Object(s.useRef)(null);return Object(s.useEffect)((function(){a.current.scrollTop=a.current.scrollHeight}),[t]),Object(l.jsx)("div",{ref:a,className:"chatbox-msg-container",children:null===t||void 0===t?void 0:t.map((function(e){var t=(null===e||void 0===e?void 0:e.from)===n?"msg msg--mine":"msg",a=(null===e||void 0===e?void 0:e.from)===n;return Object(l.jsx)(C,{className:t,self:a,roomPhotoURL:r,msgText:null===e||void 0===e?void 0:e.msg},e._id)}))})}),k=n(28),R=function(e){var t=e.conversationID,n=e.uid,r=e.pushNewMessage,a=Object(s.useState)(""),o=Object(i.a)(a,2),c=o[0],u=o[1],d=y().updateConversation;return Object(l.jsx)("div",{className:"msg-form",children:Object(l.jsxs)("form",{onSubmit:function(e){if(e.preventDefault(),c.trim()){var a={senderID:n,receiverID:t,content:c.trim()};k.a.emit("msg:create",a,(function(e){var t=e.doc,n=e.conversation;r(n.info._id,t),d(n)}))}u("")},children:[Object(l.jsx)("input",{type:"text",placeholder:"Aa",value:c,onChange:function(e){return u(e.target.value)}}),Object(l.jsx)(f,{variant:"clear",size:"large",iconName:"send",color:"var(--primary)"})]})})},E=(n(110),n(60));var z=function(e){var t,n=[],r={from:"",msg:[]},a=function(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=Object(O.a)(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw o}}}}(e=Array.from(e));try{for(a.s();!(t=a.n()).done;){var o=t.value,i={timestamp:o.timestamp,content:o.content};r.from?o.senderID!==r.from?(n.push(r),r={from:o.senderID,msg:[i]}):r.msg.push(i):(r.from=o.senderID,r.msg=[i])}}catch(s){a.e(s)}finally{a.f()}return r.from&&n.push(r),n},U=function(e){var t,n=Object(o.c)(),r=Object(g.c)((function(t){var n;return null===(n=t.messages.data[e])||void 0===n?void 0:n.messages})),a=Object(g.c)((function(t){var n;return null===(n=t.messages.data[e])||void 0===n?void 0:n.status})),i=Object(g.b)();Object(s.useEffect)((function(){var t;a&&"fulfilled"===a||!e||i(Object(E.c)({uid:null===(t=n.user)||void 0===t?void 0:t.uid,conversationID:e}))}),[null===(t=n.user)||void 0===t?void 0:t.uid,e,i,a]);return{groupMessages:function(){if(r){var e=x(r).sort((function(e,t){return e.timestamp-t.timestamp}));return z(e)}return[]},pushNewMessage:function(e,t){i(Object(E.a)({conversationID:e,message:t}))}}},A=function(){var e,t=Object(a.h)().conversationID,n=y().getConversationInfo,r=U(t),i=r.groupMessages,s=r.pushNewMessage,c=Object(o.c)(),u=i(),d=n(t),m=null===(e=c.user)||void 0===e?void 0:e.uid;return u?Object(l.jsxs)("div",{className:"chat",children:[Object(l.jsx)(D,{displayName:(null===d||void 0===d?void 0:d.displayName)||"",photoURL:(null===d||void 0===d?void 0:d.photoURL)||""}),Object(l.jsx)(L,{roomPhotoURL:(null===d||void 0===d?void 0:d.photoURL)||"",uid:m,msgList:u}),Object(l.jsx)(R,{pushNewMessage:s,conversationID:t,uid:m})]}):Object(l.jsx)("p",{children:"Loading..."})},T=function(){var e=U().pushNewMessage,t=y().updateConversation;return Object(s.useEffect)((function(){return k.a.on("private msg",(function(n){var r=n.doc,a=n.conversation;e(a.info._id,r),a.lastMsg=r,t(a)})),function(){k.a.off("private msg")}}),[e,t]),Object(l.jsxs)(r.a,{children:[Object(l.jsx)(S,{}),Object(l.jsx)(a.d,{children:Object(l.jsx)(o.a,{exact:!0,path:"/home/t/:conversationID",children:Object(l.jsx)(A,{})})})]})};t.default=T}}]);