(this["webpackJsonpchat-app"]=this["webpackJsonpchat-app"]||[]).push([[5],{101:function(e,t,n){},102:function(e,t,n){},103:function(e,t,n){},110:function(e,t,n){"use strict";n.r(t);var c=n(27),a=n(2),r=n(13),o=n(16),s=n(0),i=n.p+"static/media/search.ffb58015.svg",l=n(1),u={small:{flex:"0 0 28px",height:"28px"},medium:{flex:"0 0 40px",height:"40px"},large:{flex:"0 0 60px",height:"60px"}},m=function(e){var t=e.imgSrc,n=void 0===t?"https://i.pravatar.cc/300":t,c=e.size,a=void 0===c?"medium":c;return Object(l.jsx)("div",{className:"avatar round",style:u[a],children:Object(l.jsx)("img",{className:"round",style:{padding:"1px"},src:n,alt:""})})},j=n(15),d=n(37),f=["iconName","variant","type","size","color","className"],b=function(e){var t=e.iconName,n=e.variant,c=e.type,a=e.size,r=e.color,o=e.className,s=Object(d.a)(e,f),i=["btn"];return null===o||void 0===o||o.split(" ").forEach((function(e){return i.push(e)})),"clear"===n&&i.push("btn--nobg"),"large"===a&&i.push("btn--large"),Object(l.jsx)("button",Object(j.a)(Object(j.a)({},s),{},{type:c,className:i.join(" "),children:Object(l.jsx)("span",{style:{color:r},className:"material-icons-round",children:t})}))};function h(){var e=Object(s.useState)(""),t=Object(o.a)(e,2),n=t[0],c=t[1];return Object(l.jsxs)(l.Fragment,{children:[Object(l.jsx)("input",{type:"text",placeholder:"Search messenger",value:n,onChange:function(e){return c(e.target.value)}}),!n&&Object(l.jsx)("img",{src:i,alt:""})]})}var v=function(e){var t=e.providerData,n=e.setOpen,c=e.open,a=Object(s.useState)(!1),i=Object(o.a)(a,2),u=i[0],j=i[1],d=Object(r.c)(),f=(t||{}).photoURL;return Object(l.jsxs)("header",{className:"sidebar-header",children:[Object(l.jsxs)("div",{className:"sidebar-top",children:[Object(l.jsxs)("div",{className:"sidebar-top-left",children:[Object(l.jsx)(m,{imgSrc:f}),Object(l.jsx)("span",{children:"Chats"})]}),Object(l.jsxs)("div",{className:"sidebar-top-right",children:[Object(l.jsx)(b,{iconName:"more_horiz",title:"More"}),Object(l.jsx)(b,{iconName:u?"fullscreen_exit":"fullscreen",onClick:function(){var e=document.getElementById("root");document.fullscreenElement?(j(!1),document.exitFullscreen()):e.requestFullscreen().then((function(){return j(!0)})).catch((function(e){alert("Error attempting to enable full-screen mode: ".concat(e.message," (").concat(e.name,")"))}))}}),Object(l.jsx)(b,{iconName:"logout",title:"Signout",onClick:d.signout}),c&&Object(l.jsx)(b,{iconName:"arrow_back",color:"var(--primary)",onClick:function(){return n(!1)}})]})]}),Object(l.jsx)("div",{className:"sidebar-bottom",children:Object(l.jsx)(h,{})})]})},p=n(35);var O=function(e){var t={},n=Date.now()-e;t.seconds=Math.floor(n/1e3),t.minutes=Math.floor(t.seconds/60),t.hours=Math.floor(t.minutes/60),t.days=Math.floor(t.hours/24),t.weeks=Math.floor(t.days/7),t.months=Math.floor(t.weeks/4),t.years=Math.floor(t.months/12);var c="Just now";for(var a in t){if(!(t[a]>0))return c;c="".concat(t[a]," ").concat(t[a]>1?a:a.split("s")[0])}},x=["seen","lastMsg","contactID"],g=function(e){var t,n=e.seen,i=e.lastMsg,u=e.contactID,j=Object(d.a)(e,x),f=Object(s.useState)(O(i.timestamp)),b=Object(o.a)(f,2),h=b[0],v=b[1],g=Object(p.b)().updateSeen,N=Object(a.g)(),y=Object(r.c)(),S=j.displayName,_=j.photoURL,w=j.to,D=j.setOpen;Object(s.useEffect)((function(){v(O(i.timestamp));var e=setInterval((function(){v(O(i.timestamp))}),6e4);return function(){return clearInterval(e)}}),[i.timestamp]);return Object(l.jsxs)(c.b,{onClick:function(){g(u),D(!1)},to:w,className:w===N.pathname?"room-title__card active":"room-title__card",children:[Object(l.jsx)(m,{imgSrc:_,size:"large"}),Object(l.jsxs)("div",{className:"room-title__card-info",children:[Object(l.jsx)("p",{children:S}),Object(l.jsxs)("div",{style:{fontWeight:!n&&"600"},className:"last-msg",children:[Object(l.jsx)("span",{children:(null===(t=y.user)||void 0===t?void 0:t.uid)===(null===i||void 0===i?void 0:i.from)?"You: "+(null===i||void 0===i?void 0:i.content):null===i||void 0===i?void 0:i.content}),Object(l.jsx)("span",{children:h})]})]})]})},N=["contactID"],y=function(e){var t=e.listData,n=e.setOpen;return Object(l.jsx)("div",{className:"room-title__list",children:null===t||void 0===t?void 0:t.map((function(e){var t=e.contactID,c=Object(d.a)(e,N);return Object(l.jsx)(g,Object(j.a)(Object(j.a)({},c),{},{to:"/home/t/"+t,contactID:t,setOpen:n}),t)}))})},S=(n(101),function(){var e,t=Object(s.useState)(!1),n=Object(o.a)(t,2),c=n[0],a=n[1],i=Object(r.c)(),u=Object(p.b)();return Object(s.useEffect)((function(){window.matchMedia("(max-width: 768px)").matches&&a(!0)}),[]),Object(l.jsxs)("div",{className:"sidebar",style:{transform:c&&"translateX(0px)"},children:[Object(l.jsx)(v,{open:c,setOpen:a,providerData:null===(e=i.user)||void 0===e?void 0:e.providerData[0]}),Object(l.jsx)(y,{setOpen:a,listData:u.data}),!c&&Object(l.jsx)(b,{className:"sidebar-open",type:"button",variant:"clear",size:"large",iconName:"menu",color:"var(--primary)",onClick:function(){return a(!0)}})]})}),_=n(26),w=n(25),D=function(e){var t=e.photoURL,n=e.displayName;return Object(l.jsxs)("div",{className:"chat__header",children:[Object(l.jsxs)("div",{className:"left",children:[Object(l.jsx)(m,{imgSrc:t,size:"medium"}),Object(l.jsxs)("div",{className:"chat-info",children:[Object(l.jsx)("p",{className:"chat-info__name",children:n}),Object(l.jsx)("p",{className:"chat-info__status",children:"Active now"})]})]}),Object(l.jsxs)("div",{className:"right",children:[Object(l.jsx)(b,{variant:"clear",iconName:"phone_in_talk",color:"var(--primary)"}),Object(l.jsx)(b,{variant:"clear",iconName:"video_call",color:"var(--primary)"}),Object(l.jsx)(b,{variant:"clear",iconName:"more_horiz",color:"var(--primary)"})]})]})},I=function(e){var t=e.msgText,n=e.className,c=e.self,a=e.roomPhotoURL;return Object(l.jsxs)("div",{className:n,children:[!c&&Object(l.jsx)(m,{size:"small",imgSrc:a}),Object(l.jsx)("div",{className:"msg-list",children:null===t||void 0===t?void 0:t.map((function(e,t){var n=e.content,c=e.timestamp,a=new Date(c-6e4*(new Date).getTimezoneOffset()).toLocaleString("en-GB",{timeZone:"UTC"});return Object(l.jsx)("p",{"data-time":a,children:n},t)}))})]})},k=(n(102),function(e){var t=e.msgList,n=e.uid,c=e.roomPhotoURL,a=Object(s.useRef)(null);return Object(s.useEffect)((function(){a.current.scrollTop=a.current.scrollHeight}),[t]),Object(l.jsx)("div",{ref:a,className:"chatbox-msg-container",children:null===t||void 0===t?void 0:t.map((function(e,t){var a=(null===e||void 0===e?void 0:e.from)===n?"msg msg--mine":"msg",r=(null===e||void 0===e?void 0:e.from)===n;return Object(l.jsx)(I,{className:a,self:r,roomPhotoURL:c,msgText:null===e||void 0===e?void 0:e.msg},t)}))})}),M=function(e){var t=e.roomID,n=e.uid,c=e.pushNewMsg,a=Object(s.useState)(""),r=Object(o.a)(a,2),i=r[0],u=r[1],m=Object(p.b)().updateContact;return Object(l.jsx)("div",{className:"msg-form",children:Object(l.jsxs)("form",{onSubmit:function(e){if(e.preventDefault(),i.trim()){var a={from:n,to:t,content:i};w.a.emit("msg:create",a,(function(e){var t=e.doc,n=e.contact;c(t),m(n)}))}u("")},children:[Object(l.jsx)("input",{type:"text",placeholder:"Aa",value:i,onChange:function(e){return u(e.target.value)}}),Object(l.jsx)(b,{variant:"clear",size:"large",iconName:"send",color:"var(--primary)"})]})})},z=n(24);var C=function(e){var t,n=[],c={from:"",msg:[]},a=function(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=Object(z.a)(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var c=0,a=function(){};return{s:a,n:function(){return c>=e.length?{done:!0}:{done:!1,value:e[c++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,r=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw r}}}}(e=Array.from(e));try{for(a.s();!(t=a.n()).done;){var r=t.value,o={timestamp:r.timestamp,content:r.content};c.from?r.from!==c.from?(n.push(c),c={from:r.from,msg:[o]}):c.msg.push(o):(c.from=r.from,c.msg=[o])}}catch(s){a.e(s)}finally{a.f()}return c.from&&n.push(c),n},L=(n(103),function(){var e,t=Object(s.useState)(null),c=Object(o.a)(t,2),i=c[0],u=c[1],m=Object(a.h)().roomID,d=Object(s.useState)([]),f=Object(o.a)(d,2),b=f[0],h=f[1],v=null===(e=Object(r.c)().user)||void 0===e?void 0:e.uid,O=Object(p.b)().updateContact,x=Object(s.useCallback)((function(e){var t=Object(_.a)(b),n=t.pop(),c={timestamp:e.timestamp,content:e.content};if(n){if((null===n||void 0===n?void 0:n.from)===(null===e||void 0===e?void 0:e.from))n.msg.push(c),t.push(n);else{var a={from:e.from,msg:[c]};t.push(n),t.push(a)}h(t)}else h([{from:e.from,msg:[c]}])}),[b]);return Object(s.useEffect)((function(){fetch("/api/user/"+m).then((function(e){return e.json()})).then((function(e){u(e)})).catch((function(e){console.log(e)}))}),[m]),Object(s.useEffect)((function(){Promise.all([n.e(0),n.e(1)]).then(n.bind(null,17)).then((function(e){var t;null===(t=e.default.auth().currentUser)||void 0===t||t.getIdToken(!0).then((function(e){var t={Authorization:"Bearer "+e},n="/api/message?from=".concat(v,"&to=").concat(m);fetch(n,{headers:t}).then((function(e){return e.json()})).then((function(e){var t=Object(_.a)(e).sort((function(e,t){return e.timestamp-t.timestamp})),n=C(t);h(n)})).catch((function(e){return console.log(e)}))}))}))}),[m,v]),Object(s.useEffect)((function(){return w.a.on("private msg",(function(e){var t=e.doc,n=e.contact;t.from===m&&x(t),O(n)})),function(){w.a.off("private msg")}}),[x,m,O]),(null===i||void 0===i?void 0:i.uid)===m?Object(l.jsxs)("div",{className:"chat",children:[Object(l.jsx)(D,Object(j.a)({},i)),Object(l.jsx)(k,{roomPhotoURL:null===i||void 0===i?void 0:i.photoURL,uid:v,msgList:b}),Object(l.jsx)(M,{pushNewMsg:x,roomID:m,uid:v})]}):Object(l.jsx)("p",{children:"Loading..."})}),E=function(){return Object(l.jsxs)(c.a,{children:[Object(l.jsx)(S,{}),Object(l.jsx)(a.d,{children:Object(l.jsx)(r.a,{exact:!0,path:"/home/t/:roomID",children:Object(l.jsx)(L,{})})})]})};t.default=E}}]);